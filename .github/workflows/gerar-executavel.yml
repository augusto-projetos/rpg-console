name: Gerar EXE Automático

# Quando isso vai rodar?
on:
  push:
    branches: [ "main" ] # Roda toda vez que der push na main
  workflow_dispatch: # Permite clicar num botão "Run" pra rodar manualmente se quiser

# --- SEGURANÇA ---
permissions:
  contents: read
# ----------------------------------------------

jobs:
  construir-e-empacotar:
    runs-on: windows-latest # O robô liga um Windows novinho

    steps:
    # 0. Habilita caminhos longos no Windows (Correção do Erro 32000 chars)
    - name: Habilitar Long Paths
      run: git config --system core.longpaths true

    # 1. Baixa seu código do GitHub
    - name: Baixar Código (Checkout)
      uses: actions/checkout@v4

    # 2. Instala o Java (Substitui o JDK 24 local)
    # Vou usar o 21 (LTS) que é super estável e compatível
    - name: Instalar Java (JDK)
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '21'

    # 3. Compila o código (Substitui o "Export .jar" do VS Code)
    # Ele cria uma pasta 'bin', joga os .class lá e empacota num .jar temporário
    - name: Compilar e Criar JAR
      run: |
        mkdir bin
        javac -d bin src/*.java
        jar cfe app.jar Main -C bin .

    # 4. Cria o EXE com JRE Embutido
    # Movemos o jar para uma pasta limpa para evitar loop infinito
    - name: Criar Executável (JPackage)
      run: |
        mkdir app-lib
        move app.jar app-lib/
        
        jpackage --name "RPG-Console" `
                 --input app-lib `
                 --main-jar app.jar `
                 --main-class Main `
                 --type app-image `
                 --win-console `
                 --app-version "1.0.0" `
                 --dest saida

      # Explicação dos comandos:
      # --input app-lib: Agora ele lê SÓ essa pasta limpa (não trava mais)
      # --win-console: Garante que abre a tela preta (Console)
      # --type app-image: Cria uma pasta com o .exe e o JRE dentro

    # 5. Entrega o resultado (Artifact)
    - name: Fazer Upload do Arquivo
      uses: actions/upload-artifact@v4
      with:
        name: RPG-Console-Windows
        path: saida/RPG-Console # Pega a pasta que o jpackage criou